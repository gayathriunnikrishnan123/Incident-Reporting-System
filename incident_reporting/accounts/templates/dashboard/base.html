{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Dashboard{% endblock %}</title>
    <link rel="stylesheet" href="{% static "css/dashBase.css" %}">
    {% block headersPart %}{% endblock headersPart %}
     <style>
        {% block extra_css %}{% endblock %}
    </style> 

    
</head>
<body>
    
<div class="dashboard-container">
    <!-- Sidebar Toggle Button (moved outside sidebar) -->
    

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">F</div>
            {% comment %} <span style="font-weight: 600; color: #111827;" id="lg2">SK</span> {% endcomment %}
            <div class="sidebar-toggle" id="toggleSidebar" title="Toggle Sidebar">
                <span id="toggle-icon">‚Üê</span>
            </div>
        </div>

<nav class="sidebar-nav">
    <!-- Essentials Section -->
    <div class="nav-section">
        <div class="nav-section-title">Essentials</div>
        <a href="{% url 'dashboard' %}" class="nav-item">
            <div class="nav-icon">üìä</div>
            Dashboard
        </a>
        
        <!-- Only show System Config to admins -->
        {% if is_admin %}
        <a href="{% url 'system-config' %}" class="nav-item">
            <div class="nav-icon">‚öôÔ∏è</div>
            System Configuration
        </a>
        {% endif %}
        
        <!-- Only show User Management to admins -->
        {% if is_admin %}
        <a href="{% url 'user-management' %}" class="nav-item">
            <div class="nav-icon">üë•</div>
            User Management
        </a>
        {% endif %}
        
        <!-- Show appropriate incident label -->
        <a href="#" class="nav-item">
            <div class="nav-icon">üì¶</div>
            {% if is_responder %}My Incidents{% else %}All Incidents{% endif %}
        </a>
        
        <!-- Show Audit Log to reviewers and admins -->
        {% if is_reviewer or is_admin %}
        <a href="{% url 'auditlog' %}" class="nav-item">
            <div class="nav-icon">üìç</div>
            Audit Log
        </a>
        {% endif %}
    </div>

    <!-- Reports Section -->
    <div class="nav-section">
        <div class="nav-section-title">Reports</div>
        <a href="#" class="nav-item">
            <div class="nav-icon">üìã</div>
            Incident Reports
        </a>
        <!-- Show Analytics to reviewers and admins -->
        {% if is_reviewer or is_admin %}
        <a href="#" class="nav-item">
            <div class="nav-icon">üìà</div>
            Analytics
        </a>
        {% endif %}
    </div>

    <!-- System Section (visible to all logged-in users) -->
    <div class="nav-section">
        <div class="nav-section-title">System</div>
        <a href="{% url 'password_change' %}" class="nav-item">
            <div class="nav-icon">üîë</div>
            Change Password
        </a>
        <a href="{% url 'logout' %}" class="nav-item">
            <div class="nav-icon">üö™</div>
            Log Out
        </a>
        <a href="#" class="nav-item" onclick="toggleDarkMode()">
            <div class="nav-icon">{% if is_dark_mode %}‚òÄÔ∏è{% else %}üåô{% endif %}</div>
            {% if is_dark_mode %}Light{% else %}Dark{% endif %} Mode
        </a>
    </div>
</nav>

        
        {% comment %} <div class="user-profile">
            <div class="user-avatar">HN</div>
            <div class="user-info">
                <h4>{{ request.user.get_full_name|default:request.user.fullname }}</h4>
                <p>{{ request.user.departmentprofile_set.first.role.name }}</p>
            </div>
        </div> {% endcomment %}
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <header class="header">
            <button class="mobile-sidebar-toggle" onclick="toggleMobileSidebar()">‚ò∞</button>
            <h1>{% block page_title %}Dashboard{% endblock %}</h1>
            <div class="header-actions">
                <span class="time-period">{% block time_period %}{% now "M d, Y" %}{% endblock %}</span>
                {% block header_actions %}{% endblock %}
            </div>
        </header>

        <div class="content">
            {% block content %}
            <!-- Dashboard Content -->

            {% endblock content %}
        </div>
    </main>
    
</div>

<div class="sidebar-overlay" id="sidebarOverlay" style="display: none;"></div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const sidebar = document.getElementById("sidebar");
            const icon = document.getElementById("toggle-icon");
            const toggleBtn = document.getElementById("toggleSidebar");

            // Restore minimized state from localStorage
            const isMinimized = localStorage.getItem("sidebarMinimized") === "true";
            if (isMinimized) {
                sidebar.classList.add("minimized");
                icon.textContent = '‚Üí';
            }

            if (toggleBtn) {
                toggleBtn.addEventListener("click", function (e) {
                    e.preventDefault();
                    sidebar.classList.toggle("minimized");
                    const minimizedNow = sidebar.classList.contains("minimized");
                    localStorage.setItem("sidebarMinimized", minimizedNow);
                    icon.textContent = minimizedNow ? '‚Üí' : '‚Üê';
                    });
                }
            });


            let isDarkMode = localStorage.getItem('darkMode') === 'true';
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
                const darkIcon = document.querySelector('a[onclick*="toggleDarkMode"] .nav-icon');
                if (darkIcon) darkIcon.textContent = '‚òÄÔ∏è';
            }

            const darkToggle = document.querySelector('a[onclick*="toggleDarkMode"]');
            if (darkToggle) {
                darkToggle.addEventListener("click", function () {
                    isDarkMode = !isDarkMode;
                    document.body.classList.toggle("dark-mode", isDarkMode);
                    localStorage.setItem("darkMode", isDarkMode);
                    const darkIcon = document.querySelector('a[onclick*="toggleDarkMode"] .nav-icon');
                    if (darkIcon) darkIcon.textContent = isDarkMode ? '‚òÄÔ∏è' : 'üåô';
                });
            }
    </script>

    <script>
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebarOverlay');

        // Toggle sidebar for mobile
        function toggleMobileSidebar() {
            sidebar.classList.toggle('open');
            overlay.classList.toggle('visible');
        }

        function closeSidebar() {
            sidebar.classList.remove('open');
            overlay.classList.remove('visible');
        }

        overlay.addEventListener('click', closeSidebar);


        document.addEventListener('click', function(event) {
            const isSidebarOpen = sidebar.classList.contains('open');


            if (
                isSidebarOpen &&
                !sidebar.contains(event.target) &&
                !event.target.classList.contains('mobile-sidebar-toggle')
            ) {
                closeSidebar();
            }
        });

        
    </script>

    <script>
        const profileToggle = document.getElementById('profileToggle');
        const profileMenu = document.getElementById('profileMenu');

        profileToggle.addEventListener('click', () => {
            profileMenu.style.display = profileMenu.style.display === 'flex' ? 'none' : 'flex';
        });
    </script>



    {% block extra_js %}
    
    {% endblock %}

</body>
</html>